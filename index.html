<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Pendências</title>
<style>
body{font-family:Arial;background:#f2f4f8;display:flex;justify-content:center;margin:0}
.card{background:#fff;max-width:440px;width:100%;margin:15px;padding:15px;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,.1)}
h2{text-align:center}
label{font-weight:bold;margin-top:8px;display:block}
select,input{width:100%;padding:8px;border-radius:8px;border:1px solid #ccc}
button{width:100%;margin-top:12px;padding:10px;background:#2563eb;color:#fff;border:none;border-radius:10px;font-size:16px}
table{width:100%;border-collapse:collapse;font-size:12px;margin-top:10px}
th,td{border:1px solid #ddd;padding:5px}
th{background:#f1f5f9}
.check{color:green;font-weight:bold}
.cross{color:red;font-weight:bold}
.message{text-align:center;margin-top:8px;font-weight:bold}
.success{color:#16a34a}.warning{color:#d97706}.error{color:#dc2626}
</style>
</head>
<body>
<div class="card">
<h2>Consulta de Task - Asa Norte</h2>

<label>Operação</label>
<select id="operacao">
  <option>Asa Norte Campo Maior</option>
  <option>Asa Norte Teresina</option>
  <option>Asa Norte Parnaiba</option>
</select>

<label>RN</label>
<input id="setor" maxlength="3" placeholder="000">

<label>Cluster Primário</label>
<select id="cluster_pri"></select>

<label>Cluster Secundário</label>
<select id="cluster_sec"></select>

<label>Categoria</label>
<select id="categoria"></select>

<label>Valid</label>
<select id="filtro_valid">
  <option value="">Todos</option>
  <option value="1">Somente ✅</option>
  <option value="0">Somente ❌</option>
</select>

<button onclick="buscar()">Buscar</button>
<div class="message" id="mensagem"></div>
<div id="tabela"></div>
</div>

<script>
const SUPABASE_URL="https://nzpquivtrvqwtsiooodr.supabase.co";
const SUPABASE_KEY="SUA_ANON_KEY";

const filtros=[["cluster_pri","Cluster_Pri"],["cluster_sec","Cluster_Sec"],["categoria","Categoria"]];

async function carregarFiltros(){
 for(let [id,col] of filtros){
  const r=await fetch(`${SUPABASE_URL}/rest/v1/pendencias?select=${col}`,{headers:{apikey:SUPABASE_KEY}});
  const d=await r.json();
  const vals=[...new Set(d.map(x=>x[col]).filter(Boolean))].sort();
  const s=document.getElementById(id);
  s.innerHTML='<option value="">Todos</option>'+vals.map(v=>`<option>${v}</option>`).join('');
 }
}

async function buscar(){
 const params=[];
 const op=operacao.value,set=setor.value,cp=cluster_pri.value,cs=cluster_sec.value,cat=categoria.value,v=filtro_valid.value;
 if(op)params.push(`Operacao=eq.${encodeURIComponent(op)}`);
 if(set)params.push(`Setor=eq.${set}`);
 if(cp)params.push(`Cluster_Pri=eq.${encodeURIComponent(cp)}`);
 if(cs)params.push(`Cluster_Sec=eq.${encodeURIComponent(cs)}`);
 if(cat)params.push(`Categoria=eq.${encodeURIComponent(cat)}`);
 if(v!=="")params.push(v==="1"?"Valid=gt.0":"Valid=eq.0");

 const url=`${SUPABASE_URL}/rest/v1/pendencias?select=Pdv,Cluster_Pri,Cluster_Sec,Categoria,Meta,Real,Task,Valid&${params.join("&")}`;
 const msg=mensagem,t=tabela;
 msg.textContent="Carregando...";msg.className="message";t.innerHTML="";
 try{
  const r=await fetch(url,{headers:{apikey:SUPABASE_KEY,Authorization:`Bearer ${SUPABASE_KEY}`}});
  const d=await r.json();
  if(!d.length){msg.textContent="Nenhum registro encontrado.";msg.className="message warning";return;}
  msg.textContent=`${d.length} registro(s).`;msg.className="message success";
  let h="<table><tr><th>PDV</th><th>Cluster Pri</th><th>Cluster Sec</th><th>Categoria</th><th>Meta</th><th>Real</th><th>Task</th><th>Valid</th></tr>";
  d.forEach(r=>{
    h+=`<tr>
      <td>${r.Pdv||""}</td>
      <td>${r.Cluster_Pri||""}</td>
      <td>${r.Cluster_Sec||""}</td>
      <td>${r.Categoria||""}</td>
      <td>${r.Meta||""}</td>
      <td>${r.Real||""}</td>
      <td>${r.Task||""}</td>
      <td>${r.Valid>0?'<span class="check">✅</span>':'<span class="cross">❌</span>'}</td>
    </tr>`;
  });
  t.innerHTML=h+"</table>";
 }catch{
  msg.textContent="Erro ao consultar.";msg.className="message error";
 }
}

const operacao=document.getElementById("operacao"),
setor=document.getElementById("setor"),
cluster_pri=document.getElementById("cluster_pri"),
cluster_sec=document.getElementById("cluster_sec"),
categoria=document.getElementById("categoria"),
filtro_valid=document.getElementById("filtro_valid"),
mensagem=document.getElementById("mensagem"),
tabela=document.getElementById("tabela");

carregarFiltros();
</script>
</body>
</html>

