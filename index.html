<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Asa Norte - Consulta de Task</title>

<style>
:root{
  --primary:#333F4F;
  --secondary:#44546A;
  --light:#D9D9D9;
  --black:#000000;
  --white:#FFFFFF;
}

body{
  font-family:Arial;
  margin:20px;
  background:var(--light);
  color:var(--black);
}

.topbar{
  display:flex;
  align-items:center;
  background:var(--primary);
  padding:10px 14px;
  border-radius:6px;
  margin-bottom:12px;
}

.topbar .title{
  color:var(--white);
  font-size:18px;
  font-weight:bold;
}

.logo{
  height:36px;
  margin-right:10px;
}


label{
  font-weight:bold;
  margin-top:6px;
  display:block;
  color:var(--primary);
}

select,input{
  padding:6px;
  margin-top:2px;
  min-width:200px;
  border:1px solid var(--secondary);
  border-radius:4px;
  background:var(--white);
}

button{
  padding:8px 16px;
  margin-top:10px;
  cursor:pointer;
  background:var(--secondary);
  color:var(--white);
  border:none;
  border-radius:4px;
  transition:.2s;
}

button:hover{
  background:var(--primary);
}

.toggle{
  float:right;
  margin-top:4px;
  margin-bottom:12px;
  background:var(--primary);
}

table{
  border-collapse:collapse;
  margin-top:12px;
  font-size:13px;
  width:100%;
  background:var(--white);
}

th,td{
  border:1px solid var(--light);
  padding:6px 8px;
}

th{
  background:var(--primary);
  color:var(--white);
}

tr:nth-child(even){
  background:#f7f7f7;
}

.check{color:green;font-weight:bold}
.cross{color:red;font-weight:bold}

.message{
  margin-top:8px;
  font-weight:bold;
}

.success{color:green}
.warning{color:#b45309}
.error{color:red}

.filters{
  display:flex;
  flex-wrap:wrap;
  gap:12px;
  align-items:flex-end;
  background:var(--white);
  padding:12px;
  border-radius:6px;
  border:1px solid var(--light);
}

.filter{
  display:flex;
  flex-direction:column;
}

.compact body{margin:10px}
.compact .filters{flex-direction:column}
.compact table{font-size:11px}
.compact th,.compact td{padding:4px}
.compact h2{text-align:center}
.compact button{width:100%}


/* cart√µes mobile */
.cards{
  display:none;
}

.card{
  background:white;
  border-radius:8px;
  padding:12px;
  margin-bottom:10px;
  box-shadow:0 2px 6px rgba(0,0,0,.08);
  font-size:13px;
}

.card b{
  color:#333F4F;
}

/* bot√£o fixo no mobile */
.mobile-bar{
  display:none;
}

@media (max-width: 768px){

  table{
    display:none;
  }

  .cards{
    display:block;
    margin-top:10px;
  }

  .mobile-bar{
    display:flex;
    position:fixed;
    bottom:0;
    left:0;
    width:100%;
    background:white;
    padding:10px;
    border-top:1px solid #ccc;
    z-index:100;
  }

  .mobile-bar button{
    width:100%;
    font-size:16px;
    padding:12px;
  }

  body{
    padding-bottom:70px;
  }

}


</style>

</head>
<body>
  
<div class="topbar">
  <img src="logo.png" class="logo">
  <span class="title">Asa Norte - Consulta de Task</span>
</div>

<label >‚è∞ Atualiza√ß√£o: <span id="atualizacao"></span></label>
  
<button class="toggle" onclick="toggleLayout()">Alternar layout</button>
  
<div class="filters">
  <div class="filter">
    <label>üè¢ Opera√ß√£o</label>
    <select id="operacao">
      <option>Asa Bom Jesus</option>
      <option>Asa Norte Campo Maior</option>
      <option>Asa Norte Parnaiba</option>
      <option>Asa S√£o Raimundo</option>
      <option>Asa Norte Teresina</option>
    </select>
  </div>

  <div class="filter">
    <label>üìÖ Visita</label>
    <select id="visita">
      <option value="">Todos</option>
      <option>Seg</option>
      <option>Ter</option>
      <option>Qua</option>
      <option>Qui</option>
      <option>Sex</option>
      <option>S√°b</option>
    </select>
  </div>

  <div class="filter">
    <label>ü•á RN</label>
    <input id="setor" maxlength="3" placeholder="000">
  </div>

  <div class="filter">
    <label>üìÉ Cluster Prim√°rio</label>
    <select id="cluster_pri">
      <option value="">Todos</option>
      <option>Desenvolvimento de Portf√≥lio</option>
      <option>Digitaliza√ß√£o BEES</option>
      <option>Marketplace</option>
      <option>Volume</option>
      <option>Execu√ß√£o</option>
      <option>N√≠vel de Servi√ßo</option>
    </select>
  </div>

  <div class="filter">
    <label>üìÉ Cluster Secund√°rio</label>
    <select id="cluster_sec">
      <option value="">Todos</option>
      <option>B2O</option>
      <option>Combo</option>
      <option>SKU/PDV</option>
      <option>Categoria</option>
      <option>INPUT_MANUAL</option>
      <option>Estabiliza√ß√£o</option>
      <option>Clube B</option>
      <option>Incremento</option>
      <option>Faixa</option>
      <option>Geladeira</option>
      <option>Mapeamento de loja</option>
      <option>TTC</option>
      <option>Ado√ß√£o</option>
      <option>Materiais</option>
      <option>Atendimento</option>
      <option>Card√°pio</option>
      <option>Devolu√ß√£o</option>
      <option>Cartazete</option>
      <option>Ponto Extra</option>
      <option>Campanhas Digitais</option>
      <option>Revers√£o</option>
      <option>Scanntech & Mercaf√°cil</option>
      <option>Cadastro</option>
      <option>G√¥ndola</option>
    </select>
  </div>

  <div class="filter">
    <label>üíº Categoria</label>
    <select id="categoria">
      <option value="">Todos</option>
      <option>BEER</option>
      <option>NAB</option>
      <option>MATCH</option>
      <option>MKTPLACE</option>
      <option>CRAFT</option>
    </select>
  </div>

  <div class="filter">
    <label>‚úî Valid</label>
    <select id="filtro_valid">
      <option value="">Todos</option>
      <option value="1">Somente ‚úÖ</option>
      <option value="0">Somente ‚ùå</option>
    </select>
  </div>

  <div class="filter">
    <label>üì¶ SKU Foco</label>
    <select id="sku_foco">
      <option value="">Todos</option>
      <option>Sim</option>
      <option>N√£o</option>
    </select>
  </div>
  
  <div class="filter">
    <label>‚≠ê Score 5</label>
    <select id="score5">
      <option value="">Todos</option>
      <option>Sim</option>
      <option>N√£o</option>
    </select>
  </div>

  <div class="filter">
    <label>üè™ PDV</label>
    <input id="pdv" maxlength="5" placeholder="00000">
  </div>
  
</div>

<button onclick="buscar()">üîç Buscar</button>
<button onclick="limpar()">üßπ Limpar filtros</button>

<div class="mobile-bar">
  <button onclick="buscar()">üîç Buscar</button>
  <button onclick="limpar()">üßπ Limpar filtros</button>
</div>

  
<div class="message" id="mensagem"></div>
<div id="tabela"></div>
<div class="cards" id="cards"></div>


<script>
const SUPABASE_URL="https://nzpquivtrvqwtsiooodr.supabase.co";
const SUPABASE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im56cHF1aXZ0cnZxd3RzaW9vb2RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3MTc2MDYsImV4cCI6MjA4MzI5MzYwNn0.xkoPm1W0-IFDYCoVgq2PFhXJ9Bg8oP9j9Eht7yIJzcM";

function toggleLayout(){
 document.documentElement.classList.toggle("compact");
}

async function buscar(){
  const params=[];

  if(operacao.value) params.push(`Operacao=eq.${encodeURIComponent(operacao.value)}`);
  if(visita.value) params.push(`Visita=eq.${encodeURIComponent(visita.value)}`);
  if(setor.value) params.push(`Setor=eq.${setor.value}`);
  if(cluster_pri.value) params.push(`Cluster_Pri=eq.${encodeURIComponent(cluster_pri.value)}`);
  if(cluster_sec.value) params.push(`Cluster_Sec=eq.${encodeURIComponent(cluster_sec.value)}`);
  if(categoria.value) params.push(`Categoria=eq.${encodeURIComponent(categoria.value)}`);
  if(filtro_valid.value!=="") params.push(filtro_valid.value==="1" ? "Valid=gt.0" : "Valid=eq.0");
  if(sku_foco.value) params.push(`SKU_Foco=eq.${encodeURIComponent(sku_foco.value)}`);
  if(score5.value) params.push(`S5=eq.${encodeURIComponent(score5.value)}`);
  if(pdv.value) params.push(`Pdv=eq.${encodeURIComponent(pdv.value)}`);

  const url = `${SUPABASE_URL}/rest/v1/pendencias?select=Visita,Pdv,Nome,Cluster_Pri,Cluster_Sec,Categoria,Meta,Real,Task,Valid&${params.join("&")}`;

  mensagem.textContent="Carregando...";
  mensagem.className="message";
  tabela.innerHTML="";

  try{
    const r = await fetch(url, {
      headers:{
        apikey: SUPABASE_KEY,
        Authorization: `Bearer ${SUPABASE_KEY}`
      }
    });

    const d = await r.json();

    if(!Array.isArray(d) || !d.length){
      mensagem.textContent="Nenhum registro encontrado.";
      mensagem.className="message warning";
      return;
    }

    mensagem.textContent = `${d.length} registro(s).`;
    mensagem.className = "message success";

    let h = `<table>
      <tr>
        <th>Visita</th><th>PDV</th><th>Nome</th>
        <th>Cluster Pri</th><th>Cluster Sec</th>
        <th>Categoria</th><th>Meta</th><th>Real</th>
        <th>Task</th><th>Valid</th>
      </tr>`;

    let c = "";

    d.forEach(r=>{
      h += `<tr>
        <td>${r.Visita||""}</td>
        <td>${r.Pdv||""}</td>
        <td>${r.Nome||""}</td>
        <td>${r.Cluster_Pri||""}</td>
        <td>${r.Cluster_Sec||""}</td>
        <td>${r.Categoria||""}</td>
        <td>${r.Meta||""}</td>
        <td>${r.Real||""}</td>
        <td>${r.Task||""}</td>
        <td>${r.Valid>0 ? '‚úÖ' : '‚ùå'}</td>
      </tr>`;

      c += `<div class="card">
        <div><b>PDV:</b> ${r.Pdv||""} ‚Äî ${r.Nome||""}</div>
        <div><b>Visita:</b> ${r.Visita||""}</div>
        <div><b>Cluster:</b> ${r.Cluster_Pri||""} / ${r.Cluster_Sec||""}</div>
        <div><b>Categoria:</b> ${r.Categoria||""}</div>
        <div><b>Meta:</b> ${r.Meta||""} ‚Äî <b>Real:</b> ${r.Real||""}</div>
        <div><b>Task:</b> ${r.Task||""}</div>
        <div><b>Valid:</b> ${r.Valid>0 ? '‚úÖ' : '‚ùå'}</div>
      </div>`;
      
    });

    tabela.innerHTML = h + "</table>";
    cards.innerHTML = c;

  }catch(e){
    console.error(e);
    mensagem.textContent="Erro ao consultar os dados.";
    mensagem.className="message error";
  }
}

function limpar(){
 document.querySelectorAll("input,select").forEach(e=>e.value="");
 document.querySelectorAll("input[type=checkbox]").forEach(e=>e.checked=false);
 tabela.innerHTML="";mensagem.textContent="";
  cards.innerHTML="";mensagem.textContent="";
}

async function carregarAtualizacao(){
  const url = `${SUPABASE_URL}/rest/v1/pendencias?select=Atualizacao&order=Atualizacao.desc&limit=1`;

  try{
    const r = await fetch(url, {
      headers:{
        apikey: SUPABASE_KEY,
        Authorization: `Bearer ${SUPABASE_KEY}`
      }
    });

    const d = await r.json();

    if(d.length){
      const data = new Date(d[0].Atualizacao);

      atualizacao.textContent = data.toLocaleString("pt-BR");
    }else{
      atualizacao.textContent = "n√£o encontrada";
    }

  }catch(e){
    atualizacao.textContent = "erro ao carregar";
  }
}

  
const operacao=document.getElementById("operacao"),
visita=document.getElementById("visita"),
setor=document.getElementById("setor"),
cluster_pri=document.getElementById("cluster_pri"),
cluster_sec=document.getElementById("cluster_sec"),
categoria=document.getElementById("categoria"),
filtro_valid=document.getElementById("filtro_valid"),
sku_foco=document.getElementById("sku_foco"),
score5=document.getElementById("score5"),
pdv=document.getElementById("pdv"),
mensagem=document.getElementById("mensagem"),
tabela=document.getElementById("tabela");

const cards = document.getElementById("cards");

const atualizacao = document.getElementById("atualizacao");
carregarAtualizacao();

  
</script>
</body>
</html>




