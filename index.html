<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Pendências</title>

<style>
:root{
  --primary:#333F4F;
  --secondary:#44546A;
  --light:#D9D9D9;
  --black:#000000;
  --white:#FFFFFF;
}

body{
  font-family:Arial;
  margin:20px;
  background:var(--light);
  color:var(--black);
}

.topbar{
  display:flex;
  align-items:center;
  background:var(--primary);
  padding:10px 14px;
  border-radius:6px;
  margin-bottom:12px;
}

.topbar .title{
  color:var(--white);
  font-size:18px;
  font-weight:bold;
}

.logo{
  height:36px;
  margin-right:10px;
}

.checklist{
  max-height:160px;
  overflow:auto;
  border:1px solid var(--light);
  padding:6px;
  border-radius:4px;
  background:var(--white);
}

.checklist label{
  display:block;
  font-weight:normal;
  color:var(--black);
}

label{
  font-weight:bold;
  margin-top:6px;
  display:block;
  color:var(--primary);
}

select,input{
  padding:6px;
  margin-top:2px;
  min-width:200px;
  border:1px solid var(--secondary);
  border-radius:4px;
  background:var(--white);
}

button{
  padding:8px 16px;
  margin-top:10px;
  cursor:pointer;
  background:var(--secondary);
  color:var(--white);
  border:none;
  border-radius:4px;
  transition:.2s;
}

button:hover{
  background:var(--primary);
}

.toggle{
  float:right;
  margin-top:4px;
  margin-bottom:12px;
  background:var(--primary);
}

table{
  border-collapse:collapse;
  margin-top:12px;
  font-size:13px;
  width:100%;
  background:var(--white);
}

th,td{
  border:1px solid var(--light);
  padding:6px 8px;
}

th{
  background:var(--primary);
  color:var(--white);
}

tr:nth-child(even){
  background:#f7f7f7;
}

.check{color:green;font-weight:bold}
.cross{color:red;font-weight:bold}

.message{
  margin-top:8px;
  font-weight:bold;
}

.success{color:green}
.warning{color:#b45309}
.error{color:red}

.filters{
  display:flex;
  flex-wrap:wrap;
  gap:12px;
  align-items:flex-end;
  background:var(--white);
  padding:12px;
  border-radius:6px;
  border:1px solid var(--light);
}

.filter{
  display:flex;
  flex-direction:column;
}

.compact body{margin:10px}
.compact .filters{flex-direction:column}
.compact table{font-size:11px}
.compact th,.compact td{padding:4px}
.compact h2{text-align:center}
.compact button{width:100%}
</style>

</head>
<body>
  
<div class="topbar">
  <img src="logo.png" class="logo">
  <span class="title">Asa Norte - Consulta de Task</span>
</div>

<button class="toggle" onclick="toggleLayout()">Alternar layout</button>
  
<div class="filters">
  <div class="filter">
    <label>Operação</label>
    <select id="operacao">
      <option>Asa Bom Jesus</option>
      <option>Asa Norte Campo Maior</option>
      <option>Asa Norte Parnaiba</option>
      <option>Asa São Raimundo</option>
      <option>Asa Norte Teresina</option>
    </select>
  </div>

  <div class="filter">
    <label>Dia de Visita</label>
    <div id="visita" class="checklist">
      <label><input type="checkbox" value="Seg"> Seg</label>
      <label><input type="checkbox" value="Ter"> Ter</label>
      <label><input type="checkbox" value="Qua"> Qua</label>
      <label><input type="checkbox" value="Qui"> Qui</label>
      <label><input type="checkbox" value="Sex"> Sex</label>
      <label><input type="checkbox" value="Sáb"> Sáb</label>
    </div>
  </div>

  <div class="filter">
    <label>RN</label>
    <input id="setor" maxlength="3" placeholder="000">
  </div>

  <div class="filter">
  <label>Cluster Primário</label>
  <div id="cluster_pri" class="checklist">
    <label><input type="checkbox" value="Desenvolvimento de Portfólio"> Desenvolvimento de Portfólio</label>
    <label><input type="checkbox" value="Digitalização BEES"> Digitalização BEES</label>
    <label><input type="checkbox" value="Marketplace"> Marketplace</label>
    <label><input type="checkbox" value="Volume"> Volume</label>
    <label><input type="checkbox" value="Execução"> Execução</label>
    <label><input type="checkbox" value="Nível de Serviço"> Nível de Serviço</label>
  </div>
</div>

  <div class="filter">
    <label>Cluster Secundário</label>
    <div id="cluster_sec" class="checklist">
      <label><input type="checkbox" value="B2O"> B2O</label>
      <label><input type="checkbox" value="Combo"> Combo</label>
      <label><input type="checkbox" value="SKU/PDV"> SKU/PDV</label>
      <label><input type="checkbox" value="Categoria"> Categoria</label>
      <label><input type="checkbox" value="INPUT_MANUAL"> INPUT_MANUAL</label>
      <label><input type="checkbox" value="Estabilização"> Estabilização</label>
      <label><input type="checkbox" value="Clube B"> Clube B</label>
      <label><input type="checkbox" value="Incremento"> Incremento</label>
      <label><input type="checkbox" value="Faixa"> Faixa</label>
      <label><input type="checkbox" value="Geladeira"> Geladeira</label>
      <label><input type="checkbox" value="Mapeamento de loja"> Mapeamento de loja</label>
      <label><input type="checkbox" value="TTC"> TTC</label>
      <label><input type="checkbox" value="Adoção"> Adoção</label>
      <label><input type="checkbox" value="Materiais"> Materiais</label>
      <label><input type="checkbox" value="Atendimento"> Atendimento</label>
      <label><input type="checkbox" value="Cardápio"> Cardápio</label>
      <label><input type="checkbox" value="Devolução"> Devolução</label>
      <label><input type="checkbox" value="Cartazete"> Cartazete</label>
      <label><input type="checkbox" value="Ponto Extra"> Ponto Extra</label>
      <label><input type="checkbox" value="Campanhas Digitais"> Campanhas Digitais</label>
      <label><input type="checkbox" value="Reversão"> Reversão</label>
      <label><input type="checkbox" value="Scanntech & Mercafácil"> Scanntech & Mercafácil</label>
      <label><input type="checkbox" value="Cadastro"> Cadastro</label>
      <label><input type="checkbox" value="Gôndola"> Gôndola</label>
    </div>
  </div>

  <div class="filter">
    <label>Categoria</label>
    <div id="categoria" class="checklist">
      <label><input type="checkbox" value="BEER"> BEER</label>
      <label><input type="checkbox" value="NAB"> NAB</label>
      <label><input type="checkbox" value="MATCH"> MATCH</label>
      <label><input type="checkbox" value="MKTPLACE"> MKTPLACE</label>
      <label><input type="checkbox" value="CRAFT"> CRAFT</label>
    </div>
  </div>

  <div class="filter">
    <label>Valid</label>
    <select id="filtro_valid">
      <option value="">Todos</option>
      <option value="1">Somente ✅</option>
      <option value="0">Somente ❌</option>
    </select>
  </div>

  <div class="filter">
    <label>SKU Foco</label>
    <select id="sku_foco">
      <option value="">Todos</option>
      <option>Sim</option>
      <option>Não</option>
    </select>
  </div>
  
  <div class="filter">
    <label>Score 5</label>
    <select id="score_5">
      <option value="">Todos</option>
      <option>Sim</option>
      <option>Não</option>
    </select>
  </div>
  
</div>

<button onclick="buscar()">Buscar</button>

<div class="message" id="mensagem"></div>
<div id="tabela"></div>

<script>
const SUPABASE_URL="https://nzpquivtrvqwtsiooodr.supabase.co";
const SUPABASE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im56cHF1aXZ0cnZxd3RzaW9vb2RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3MTc2MDYsImV4cCI6MjA4MzI5MzYwNn0.xkoPm1W0-IFDYCoVgq2PFhXJ9Bg8oP9j9Eht7yIJzcM";

function toggleLayout(){
 document.documentElement.classList.toggle("compact");
}

function getChecked(containerId){
  return Array.from(document.querySelectorAll(`#${containerId} input:checked`))
    .map(el => el.value);
}
  
async function buscar(){
  const params = [];

  // Campos normais
  if(operacao.value) params.push(`Operacao=eq.${encodeURIComponent(operacao.value)}`);
  if(setor.value) params.push(`Setor=eq.${setor.value}`);
  if(filtro_valid.value !== "") params.push(filtro_valid.value === "1" ? "Valid=gt.0" : "Valid=eq.0");
  if(sku_foco.value) params.push(`SKU_Foco=eq.${encodeURIComponent(sku_foco.value)}`);
  if(score5.value) params.push(`S5=eq.${encodeURIComponent(score5.value)}`);

  // Campos com múltipla seleção (checkbox)
  const visitas = getChecked("visita");
  if(visitas.length) params.push(`Visita=in.(${visitas.map(encodeURIComponent).join(",")})`);

  const categorias = getChecked("categoria");
  if(categorias.length) params.push(`Categoria=in.(${categorias.map(encodeURIComponent).join(",")})`);

  const pri = getChecked("cluster_pri");
  if(pri.length) params.push(`Cluster_Pri=in.(${pri.map(encodeURIComponent).join(",")})`);

  const sec = getChecked("cluster_sec");
  if(sec.length) params.push(`Cluster_Sec=in.(${sec.map(encodeURIComponent).join(",")})`);

  const url = `${SUPABASE_URL}/rest/v1/pendencias?select=Visita,Pdv,Nome,Cluster_Pri,Cluster_Sec,Categoria,Meta,Real,Task,Valid&${params.join("&")}`;

  mensagem.textContent = "Carregando...";
  mensagem.className = "message";
  tabela.innerHTML = "";

  try {
    const r = await fetch(url, {
      headers: {
        apikey: SUPABASE_KEY,
        Authorization: `Bearer ${SUPABASE_KEY}`
      }
    });

    const d = await r.json();

    if(!Array.isArray(d) || !d.length){
      mensagem.textContent = "Nenhum registro encontrado.";
      mensagem.className = "message warning";
      return;
    }

    mensagem.textContent = `${d.length} registro(s).`;
    mensagem.className = "message success";

    let h = `<table>
      <tr>
        <th>Visita</th><th>PDV</th><th>Nome</th>
        <th>Cluster Pri</th><th>Cluster Sec</th>
        <th>Categoria</th><th>Meta</th><th>Real</th>
        <th>Task</th><th>Valid</th>
      </tr>`;

    d.forEach(r => {
      h += `<tr>
        <td>${r.Visita||""}</td>
        <td>${r.Pdv||""}</td>
        <td>${r.Nome||""}</td>
        <td>${r.Cluster_Pri||""}</td>
        <td>${r.Cluster_Sec||""}</td>
        <td>${r.Categoria||""}</td>
        <td>${r.Meta||""}</td>
        <td>${r.Real||""}</td>
        <td>${r.Task||""}</td>
        <td>${r.Valid > 0 ? '<span class="check">✅</span>' : '<span class="cross">❌</span>'}</td>
      </tr>`;
    });

    tabela.innerHTML = h + "</table>";

  } catch(e){
    console.error(e);
    mensagem.textContent = "Erro ao consultar os dados.";
    mensagem.className = "message error";
  }
}

const operacao=document.getElementById("operacao"),
visita=document.getElementById("visita"),
setor=document.getElementById("setor"),
cluster_pri=document.getElementById("cluster_pri"),
cluster_sec=document.getElementById("cluster_sec"),
categoria=document.getElementById("categoria"),
filtro_valid=document.getElementById("filtro_valid"),
sku_foco=document.getElementById("sku_foco"),
score5=document.getElementById("score_5"),
mensagem=document.getElementById("mensagem"),
tabela=document.getElementById("tabela");


</script>
</body>
</html>













