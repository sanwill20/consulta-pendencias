<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Pend√™ncias</title>

<style>
:root{
  --primary:#333F4F;
  --secondary:#44546A;
  --light:#D9D9D9;
  --black:#000000;
  --white:#FFFFFF;
}

body{
  font-family:Arial;
  margin:20px;
  background:var(--light);
  color:var(--black);
}

.topbar{
  display:flex;
  align-items:center;
  background:var(--primary);
  padding:10px 14px;
  border-radius:6px;
  margin-bottom:12px;
}

.topbar .title{color:white;font-size:18px;font-weight:bold}
.logo{height:36px;margin-right:10px}

.filters{
  display:flex;
  flex-wrap:wrap;
  gap:12px;
  background:white;
  padding:12px;
  border-radius:6px;
}

.filter{display:flex;flex-direction:column}
label{font-weight:bold;color:var(--primary)}
select,input{padding:6px;border-radius:4px;border:1px solid #ccc;transition:.25s}
select:focus,input:focus{transform:scale(1.05)}

button{padding:8px 16px;border:none;border-radius:4px;background:var(--secondary);color:white;cursor:pointer}
button:hover{background:var(--primary)}

table{border-collapse:collapse;width:100%;margin-top:12px;background:white}
th,td{border:1px solid #ddd;padding:6px}
th{background:var(--primary);color:white}
tr:nth-child(even){background:#f7f7f7}

.message{margin-top:10px;font-weight:bold}
.success{color:green}.warning{color:#b45309}.error{color:red}

.check{color:green}.cross{color:red}
</style>
</head>

<body>

<div class="topbar">
  <img src="logo.png" class="logo">
  <span class="title">Consulta de Pend√™ncias</span>
</div>

<div class="filters">

  <div class="filter"><label>üîç Busca</label><input id="busca" placeholder="Nome, PDV, Task..."></div>

  <div class="filter"><label>üè¢ Opera√ß√£o</label>
    <select id="operacao">
      <option value="">Todas</option>
      <option>Asa Norte Teresina</option>
      <option>Asa Bom Jesus</option>
    </select>
  </div>

  <div class="filter"><label>üìÖ Visita</label>
    <select id="visita"><option value="">Todas</option><option>Seg</option><option>Ter</option></select>
  </div>

  <div class="filter"><label>üì¶ SKU Foco</label>
    <select id="sku_foco"><option value="">Todos</option><option>Sim</option><option>N√£o</option></select>
  </div>

  <div class="filter"><label>‚≠ê Score 5</label>
    <select id="score5"><option value="">Todos</option><option>Sim</option><option>N√£o</option></select>
  </div>

  <div class="filter"><label>‚úî Valid</label>
    <select id="filtro_valid"><option value="">Todos</option><option value="1">Somente ‚úÖ</option><option value="0">Somente ‚ùå</option></select>
  </div>

</div>

<button onclick="buscar()">Buscar</button>
<button onclick="limpar()">Limpar filtros</button>

<div class="message" id="mensagem"></div>
<div id="tabela"></div>

<script>
const SUPABASE_URL="https://nzpquivtrvqwtsiooodr.supabase.co";
const SUPABASE_KEY="SUA_CHAVE";

const $=id=>document.getElementById(id);

async function buscar(){
  let params=[];
  if(busca.value) params.push(`or=(Nome.ilike.*${busca.value}*,Pdv.ilike.*${busca.value}*,Task.ilike.*${busca.value}*)`);
  if(operacao.value) params.push(`Operacao=eq.${operacao.value}`);
  if(visita.value) params.push(`Visita=eq.${visita.value}`);
  if(sku_foco.value) params.push(`SKU_Foco=eq.${sku_foco.value}`);
  if(score5.value) params.push(`S5=eq.${score5.value}`);
  if(filtro_valid.value!=="") params.push(filtro_valid.value==="1"?"Valid=gt.0":"Valid=eq.0");

  const url=`${SUPABASE_URL}/rest/v1/pendencias?select=Visita,Pdv,Nome,Task,Valid&${params.join("&")}`;

  mensagem.textContent="Carregando...";
  tabela.innerHTML="";

  const r=await fetch(url,{headers:{apikey:SUPABASE_KEY,Authorization:`Bearer ${SUPABASE_KEY}`}});
  const d=await r.json();

  if(!d.length){mensagem.textContent="Nada encontrado";mensagem.className="message warning";return;}

  mensagem.textContent=`${d.length} registros`;
  mensagem.className="message success";

  let h=`<table><tr><th>Visita</th><th>PDV</th><th>Nome</th><th>Task</th><th>Valid</th></tr>`;
  d.forEach(r=>{
    h+=`<tr>
      <td>${r.Visita||""}</td>
      <td>${r.Pdv||""}</td>
      <td>${r.Nome||""}</td>
      <td>${r.Task||""}</td>
      <td>${r.Valid>0?'‚úÖ':'‚ùå'}</td>
    </tr>`;
  });

  tabela.innerHTML=h+"</table>";
}

function limpar(){
  document.querySelectorAll("input,select").forEach(e=>e.value="");
  tabela.innerHTML="";
  mensagem.textContent="";
}

const busca=$("busca"),operacao=$("operacao"),visita=$("visita"),
sku_foco=$("sku_foco"),score5=$("score5"),filtro_valid=$("filtro_valid"),
mensagem=$("mensagem"),tabela=$("tabela");
</script>

</body>
</html>
