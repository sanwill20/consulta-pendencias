<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>PendÃªncias</title>

<style>
:root{--primary:#333F4F;--secondary:#44546A;--light:#D9D9D9;--black:#000;--white:#FFF;}
body{font-family:Arial;margin:20px;background:var(--light)}
.filters{display:flex;flex-wrap:wrap;gap:12px;background:white;padding:12px;border-radius:6px}
.filter{display:flex;flex-direction:column;position:relative}
label{font-weight:bold;color:var(--primary)}
input,select{padding:6px;border-radius:4px;border:1px solid #ccc}

.multi{border:1px solid #ccc;border-radius:4px;padding:6px;background:white;cursor:pointer;min-width:200px}
.multi-panel{position:absolute;top:100%;left:0;background:white;border:1px solid #ccc;border-radius:4px;max-height:200px;overflow:auto;display:none;z-index:10}
.multi-panel label{display:block;font-weight:normal}

table{border-collapse:collapse;width:100%;margin-top:12px;background:white}
th,td{border:1px solid #ddd;padding:6px}
th{background:#333F4F;color:white}
tr:nth-child(even){background:#f7f7f7}
button{padding:8px 16px;margin-top:10px;border:none;border-radius:4px;background:#44546A;color:white;cursor:pointer}
button:hover{background:#333F4F}
.message{margin-top:10px;font-weight:bold}
.success{color:green}.warning{color:#b45309}.error{color:red}
.check{color:green}.cross{color:red}
</style>
</head>

<body>

<div class="filters">

<div class="filter"><label>ğŸ” Busca</label><input id="busca" placeholder="Nome, PDV, Task..."></div>

<div class="filter"><label>ğŸ¢ OperaÃ§Ã£o</label><select id="operacao">
<option>Asa Bom Jesus</option><option>Asa Norte Teresina</option>
</select></div>

<div class="filter">
<label>ğŸ“… Visita</label>
<div class="multi" onclick="toggle('visitaPanel')">Selecionar</div>
<div class="multi-panel" id="visitaPanel">
<label><input type="checkbox" value="Seg"> Seg</label>
<label><input type="checkbox" value="Ter"> Ter</label>
<label><input type="checkbox" value="Qua"> Qua</label>
</div>
</div>

<div class="filter">
<label>ğŸ“ƒ Cluster PrimÃ¡rio</label>
<div class="multi" onclick="toggle('priPanel')">Selecionar</div>
<div class="multi-panel" id="priPanel">
<label><input type="checkbox" value="Volume"> Volume</label>
<label><input type="checkbox" value="ExecuÃ§Ã£o"> ExecuÃ§Ã£o</label>
</div>
</div>

<div class="filter">
<label>ğŸ“ƒ Cluster SecundÃ¡rio</label>
<div class="multi" onclick="toggle('secPanel')">Selecionar</div>
<div class="multi-panel" id="secPanel">
<label><input type="checkbox" value="Combo"> Combo</label>
<label><input type="checkbox" value="Categoria"> Categoria</label>
</div>
</div>

<div class="filter">
<label>ğŸ’¼ Categoria</label>
<div class="multi" onclick="toggle('catPanel')">Selecionar</div>
<div class="multi-panel" id="catPanel">
<label><input type="checkbox" value="BEER"> BEER</label>
<label><input type="checkbox" value="NAB"> NAB</label>
</div>
</div>

<div class="filter"><label>âœ” Valid</label><select id="filtro_valid">
<option value="">Todos</option><option value="1">Somente âœ…</option><option value="0">Somente âŒ</option>
</select></div>

</div>

<button onclick="buscar()">Buscar</button>
<button onclick="limpar()">Limpar filtros</button>

<div class="message" id="mensagem"></div>
<div id="tabela"></div>

<script>
const SUPABASE_URL="https://nzpquivtrvqwtsiooodr.supabase.co";
const SUPABASE_KEY="SUA_CHAVE";

function toggle(id){
 document.getElementById(id).style.display =
 document.getElementById(id).style.display=="block"?"none":"block";
}

function pegarMulti(id){
 return [...document.querySelectorAll(`#${id} input:checked`)].map(e=>e.value);
}

async function buscar(){
 let params=[];
 if(busca.value) params.push(`or=(Nome.ilike.*${busca.value}*,Task.ilike.*${busca.value}*)`);

 const visita=pegarMulti("visitaPanel");
 visita.forEach(v=>params.push(`Visita=eq.${v}`));

 const pri=pegarMulti("priPanel");
 pri.forEach(v=>params.push(`Cluster_Pri=eq.${v}`));

 const sec=pegarMulti("secPanel");
 sec.forEach(v=>params.push(`Cluster_Sec=eq.${v}`));

 const cat=pegarMulti("catPanel");
 cat.forEach(v=>params.push(`Categoria=eq.${v}`));

 if(filtro_valid.value!=="") params.push(filtro_valid.value==="1"?"Valid=gt.0":"Valid=eq.0");

 const url=`${SUPABASE_URL}/rest/v1/pendencias?select=Visita,Pdv,Nome,Task,Valid&${params.join("&")}`;

 mensagem.textContent="Carregando...";
 tabela.innerHTML="";

 const r=await fetch(url,{headers:{apikey:SUPABASE_KEY,Authorization:`Bearer ${SUPABASE_KEY}`}});
 const d=await r.json();

 if(!d.length){mensagem.textContent="Nada encontrado";mensagem.className="message warning";return;}

 mensagem.textContent=`${d.length} registros`;
 mensagem.className="message success";

 let h=`<table><tr><th>Visita</th><th>PDV</th><th>Nome</th><th>Task</th><th>Valid</th></tr>`;
 d.forEach(r=>{
   h+=`<tr><td>${r.Visita}</td><td>${r.Pdv}</td><td>${r.Nome}</td><td>${r.Task}</td><td>${r.Valid>0?'âœ…':'âŒ'}</td></tr>`;
 });
 tabela.innerHTML=h+"</table>";
}

function limpar(){
 document.querySelectorAll("input,select").forEach(e=>e.value="");
 document.querySelectorAll("input[type=checkbox]").forEach(e=>e.checked=false);
 tabela.innerHTML="";mensagem.textContent="";
}
</script>

</body>
</html>
