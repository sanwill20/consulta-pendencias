<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Pendências</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
:root{
  --primary:#333F4F;
  --secondary:#44546A;
  --light:#D9D9D9;
  --white:#FFFFFF;
}
body{font-family:Arial;margin:20px;background:var(--light)}
.topbar{display:flex;align-items:center;background:var(--primary);padding:10px 14px;border-radius:6px;color:white;margin-bottom:12px}

.filters{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:14px;background:white;padding:14px;border-radius:8px}

.filter label{font-weight:bold;font-size:13px;color:var(--primary);margin-bottom:4px}

.multi-select{position:relative}
.select-box{border:1px solid var(--secondary);padding:7px;border-radius:4px;background:white;cursor:pointer;font-size:13px}
.select-box:hover{background:#f4f4f4}

.options{
  display:none;
  position:absolute;
  background:white;
  border:1px solid var(--secondary);
  border-radius:6px;
  max-height:260px;
  overflow-y:auto;
  z-index:50;
  width:100%;
  margin-top:4px;
  box-shadow:0 6px 14px rgba(0,0,0,.15);
  animation:fade .2s ease;
}

.multi-select.open .options{display:block}

@keyframes fade{from{opacity:0;transform:translateY(-6px)}to{opacity:1;transform:translateY(0)}}

.options label{display:flex;align-items:center;padding:6px 8px;font-size:12px;cursor:pointer}
.options label:hover{background:#f0f0f0}

input[type=text],select{
  padding:7px;
  border:1px solid var(--secondary);
  border-radius:4px;
  font-size:13px;
}

button{
  padding:9px 14px;
  margin-top:10px;
  background:var(--secondary);
  color:white;
  border:none;
  border-radius:4px;
  cursor:pointer
}
button:hover{background:var(--primary)}
.btn-clear{background:#999}.btn-clear:hover{background:#777}

.icon{margin-right:6px;color:#666}

table{margin-top:14px;border-collapse:collapse;width:100%;background:white;font-size:13px}
th,td{border:1px solid #ddd;padding:6px 8px}
th{background:var(--primary);color:white}
tr:nth-child(even){background:#f7f7f7}
.check{color:green;font-weight:bold}
.cross{color:red;font-weight:bold}
</style>
</head>

<body>

<div class="topbar">Pendências — Consulta</div>

<div class="filters">

<div class="filter">
  <label><i class="fa fa-search icon"></i>Busca</label>
  <input id="busca" type="text" placeholder="PDV, Nome ou Task">
</div>

<div class="filter">
  <label><i class="fa fa-building icon"></i>Operação</label>
  <div class="multi-select" id="operacao">
    <div class="select-box">Selecionar...</div>
    <div class="options">
      <label><input type="checkbox" value="Asa Bom Jesus"> Asa Bom Jesus</label>
      <label><input type="checkbox" value="Asa Norte Campo Maior"> Asa Norte Campo Maior</label>
      <label><input type="checkbox" value="Asa Norte Parnaiba"> Asa Norte Parnaiba</label>
      <label><input type="checkbox" value="Asa São Raimundo"> Asa São Raimundo</label>
      <label><input type="checkbox" value="Asa Norte Teresina"> Asa Norte Teresina</label>
    </div>
  </div>
</div>

<div class="filter">
  <label><i class="fa fa-hashtag icon"></i>RN</label>
  <input id="setor" maxlength="3" placeholder="000">
</div>

<div class="filter">
  <label><i class="fa fa-calendar icon"></i>Visita</label>
  <div class="multi-select" id="visita">
    <div class="select-box">Selecionar...</div>
    <div class="options">
      <label><input type="checkbox" value="Seg"> Seg</label>
      <label><input type="checkbox" value="Ter"> Ter</label>
      <label><input type="checkbox" value="Qua"> Qua</label>
      <label><input type="checkbox" value="Qui"> Qui</label>
      <label><input type="checkbox" value="Sex"> Sex</label>
      <label><input type="checkbox" value="Sáb"> Sáb</label>
    </div>
  </div>
</div>

<div class="filter">
  <label><i class="fa fa-layer-group icon"></i>Cluster Primário</label>
  <div class="multi-select" id="cluster_pri">
    <div class="select-box">Selecionar...</div>
    <div class="options">
      <label><input type="checkbox" value="Execução"> Execução</label>
      <label><input type="checkbox" value="Volume"> Volume</label>
      <label><input type="checkbox" value="Marketplace"> Marketplace</label>
    </div>
  </div>
</div>

<div class="filter">
  <label><i class="fa fa-layer-group icon"></i>Cluster Secundário</label>
  <div class="multi-select" id="cluster_sec">
    <div class="select-box">Selecionar...</div>
    <div class="options">
      <label><input type="checkbox" value="B2O"> B2O</label>
      <label><input type="checkbox" value="Combo"> Combo</label>
      <label><input type="checkbox" value="Geladeira"> Geladeira</label>
    </div>
  </div>
</div>

<div class="filter">
  <label><i class="fa fa-tags icon"></i>Categoria</label>
  <div class="multi-select" id="categoria">
    <div class="select-box">Selecionar...</div>
    <div class="options">
      <label><input type="checkbox" value="BEER"> BEER</label>
      <label><input type="checkbox" value="NAB"> NAB</label>
      <label><input type="checkbox" value="MATCH"> MATCH</label>
    </div>
  </div>
</div>

<div class="filter">
  <label><i class="fa fa-star icon"></i>SKU Foco</label>
  <select id="sku_foco"><option value="">Todos</option><option>Sim</option><option>Não</option></select>
</div>

<div class="filter">
  <label><i class="fa fa-trophy icon"></i>Score 5</label>
  <select id="score5"><option value="">Todos</option><option>Sim</option><option>Não</option></select>
</div>

<div class="filter">
  <label><i class="fa fa-check icon"></i>Valid</label>
  <select id="valid"><option value="">Todos</option><option value="1">Somente ✅</option><option value="0">Somente ❌</option></select>
</div>

</div>

<button onclick="buscar()">Buscar</button>
<button class="btn-clear" onclick="limpar()">Limpar</button>

<pre id="mensagem"></pre>
<div id="tabela"></div>

<script>
const SUPABASE_URL="https://nzpquivtrvqwtsiooodr.supabase.co";
const SUPABASE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im56cHF1aXZ0cnZxd3RzaW9vb2RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3MTc2MDYsImV4cCI6MjA4MzI5MzYwNn0.xkoPm1W0-IFDYCoVgq2PFhXJ9Bg8oP9j9Eht7yIJzcM";

document.addEventListener("click",e=>{
  document.querySelectorAll(".multi-select").forEach(ms=>{ if(!ms.contains(e.target)) ms.classList.remove("open");});
});
document.querySelectorAll(".select-box").forEach(b=>b.onclick=e=>{e.stopPropagation();b.parentElement.classList.toggle("open");});
document.querySelectorAll(".options input").forEach(cb=>cb.onchange=()=>{
  const box=cb.closest(".multi-select");
  const c=box.querySelectorAll("input:checked").length;
  box.querySelector(".select-box").textContent=c?`${c} selecionado(s)`:"Selecionar...";
});

function getMulti(id){return [...document.querySelectorAll(`#${id} input:checked`)].map(i=>i.value);}

function limpar(){
  document.querySelectorAll("input").forEach(e=>{if(e.type==="checkbox")e.checked=false;else e.value="";});
  document.querySelectorAll("select").forEach(s=>s.value="");
  document.querySelectorAll(".select-box").forEach(b=>b.textContent="Selecionar...");
  tabela.innerHTML="";mensagem.textContent="Filtros limpos.";
}

async function buscar(){
  let params=[];
  if(busca.value) params.push(`or=(Pdv.ilike.*${busca.value}*,Task.ilike.*${busca.value}*)`);
  if(setor.value) params.push(`Setor=eq.${setor.value}`);
  if(valid.value!=="") params.push(valid.value==="1"?"Valid=gt.0":"Valid=eq.0");
  if(sku_foco.value) params.push(`SKU_Foco=eq.${sku_foco.value}`);
  if(score5.value) params.push(`S5=eq.${score5.value}`);

  const m = id => {const v=getMulti(id); if(v.length) params.push(`${id}=in.(${v.join(",")})`);};
  m("operacao"); m("visita"); m("cluster_pri"); m("cluster_sec"); m("categoria");

  const url = `${SUPABASE_URL}/rest/v1/pendencias?select=Pdv,Nome,Cluster_Pri,Cluster_Sec,Categoria,Meta,Real,Task,Valid&${params.join("&")}`;

  const r = await fetch(url,{headers:{apikey:SUPABASE_KEY,Authorization:`Bearer ${SUPABASE_KEY}`}});
  const d = await r.json();

  if(!d.length){mensagem.textContent="Nenhum resultado.";tabela.innerHTML="";return;}

  let h="<table><tr><th>PDV</th><th>Nome</th><th>Cluster Pri</th><th>Cluster Sec</th><th>Categoria</th><th>Meta</th><th>Real</th><th>Task</th><th>Valid</th></tr>";
  d.forEach(r=>{
    h+=`<tr><td>${r.Pdv}</td><td>${r.Nome}</td><td>${r.Cluster_Pri}</td><td>${r.Cluster_Sec}</td><td>${r.Categoria}</td><td>${r.Meta}</td><td>${r.Real}</td><td>${r.Task}</td><td>${r.Valid>0?'<span class="check">✅</span>':'<span class="cross">❌</span>'}</td></tr>`;
  });
  tabela.innerHTML=h+"</table>";
  mensagem.textContent=`${d.length} registro(s).`;
}

const busca=busca=document.getElementById("busca"),
setor=document.getElementById("setor"),
sku_foco=document.getElementById("sku_foco"),
score5=document.getElementById("score5"),
valid=document.getElementById("valid"),
mensagem=document.getElementById("mensagem"),
tabela=document.getElementById("tabela");
</script>

</body>
</html>
